# üìã –ò—Ç–æ–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞:** 21 —è–Ω–≤–∞—Ä—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.3.0

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### üîí –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–£–¥–∞–ª–µ–Ω env.txt –∏–∑ Git**
   - ‚úÖ –§–∞–π–ª —É–¥–∞–ª–µ–Ω –∏–∑ –∏–Ω–¥–µ–∫—Å–∞ Git (`git rm --cached env.txt`)
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
   - ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢–°–Ø:** –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏ —Å–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (—Å–º. `URGENT-SECURITY-FIX.md`)

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è MIME-—Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤**
   - ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `file-type@18.7.0`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ MIME-—Ç–∏–ø–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è base64
   - ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ: PNG, JPEG, JPG, WebP

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–µ–∫–æ–≤**
   - ‚úÖ –ú–∞–∫—Å–∏–º—É–º 3 —á–µ–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### üõ°Ô∏è –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö**
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `sanitizeLogData()` –≤ `logger.ts`
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–µ–π: password, token, initData, cardNumber, botToken, apiKey, secret
   - ‚úÖ –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `***REDACTED***`

5. **HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —Å HTTP –Ω–∞ HTTPS –≤ production
   - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `x-forwarded-proto`

6. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î**
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `003_security_improvements.sql`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã CHECK constraints –¥–ª—è:
     - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã (orders, order_items, products)
     - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (order_items, carts)
     - –î–∏–∞–ø–∞–∑–æ–Ω –±–æ–Ω—É—Å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ (0-100%)
     - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã –±–æ–Ω—É—Å–æ–≤

7. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î**
   - ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
     - `idx_orders_created_at`, `idx_orders_payment_status`, `idx_orders_delivery_date`
     - `idx_order_status_history_changed_at`, `idx_order_status_history_status`
     - `idx_products_price`, `idx_products_created_at`
     - –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

8. **–£–ª—É—á—à–µ–Ω–Ω—ã–π health check**
   - ‚úÖ –≠–Ω–¥–ø–æ–π–Ω—Ç `/health` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
     - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
     - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
   - ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
   - ‚úÖ HTTP 503 –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ª—é–±–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

9. **–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Redis**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ `testRedisConnection()` –≤ `redis.ts`
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ health check

### üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

10. **–°–æ–∑–¥–∞–Ω env.example**
    - ‚úÖ –§–∞–π–ª-—à–∞–±–ª–æ–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    - ‚úÖ –ë–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
    - ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

11. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
    - ‚úÖ `README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    - ‚úÖ `docs/backend.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    - ‚úÖ `docs/architecture.md` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
    - ‚úÖ `docs/CHANGELOG.md` - —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üì¶ –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `file-type@18.7.0` - –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ MIME-—Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤

## üóÑÔ∏è –ù–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

- `003_security_improvements.sql` - CHECK constraints –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### 1. –°–º–µ–Ω–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞ (–ö–†–ò–¢–ò–ß–ù–û!)

–ï—Å–ª–∏ `env.txt` –±—ã–ª –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–∑–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω (`/mybots` ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ ‚Üí "API Token" ‚Üí "Revoke current token")
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
4. –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ `env.txt` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
docker-compose exec backend npm run migrate
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
psql -h postgres -U chvetyk -d chvetyk_db -f backend/src/database/migrations/003_security_improvements.sql
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd backend
npm install
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Docker:
```bash
docker-compose build backend
docker-compose up -d backend
```

### 4. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
git add .
git commit -m "Security improvements v1.3.0: file validation, log sanitization, DB constraints, HTTPS redirect"
git push origin main
```

**–í–ê–ñ–ù–û:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `env.txt` –ù–ï –ø–æ–ø–∞–¥–µ—Ç –≤ –∫–æ–º–º–∏—Ç:
```bash
git status
# env.txt –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

### 5. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/TG_BOT_Chvetyk/TG_BOT_Chvetyk
git pull origin main
docker compose down
docker compose build
docker compose up -d
docker compose ps
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **Health Check:**
   ```bash
   curl http://localhost:3000/health
   ```
   –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å `database: true` –∏ `redis: true`

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞:**
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫–∞ –æ–± –æ–ø–ª–∞—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è MIME-—Ç–∏–ø–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤ (–º–∞–∫—Å–∏–º—É–º 3)

3. **–õ–æ–≥–∏:**
   ```bash
   docker compose logs backend | grep -i "redacted"
   ```
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∫—Ä—ã—Ç—ã

4. **HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç (–≤ production):**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `http://your-domain.com` - –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ `https://`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](security-audit.md) - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [–°—Ä–æ—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤](URGENT-SECURITY-FIX.md) - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é
- [Changelog](CHANGELOG.md) - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –°–º–µ–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–µ—Å–ª–∏ env.txt –±—ã–ª –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (`003_security_improvements.sql`)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install` –≤ backend)
- [ ] –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —á–µ–∫–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `***REDACTED***`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç (–≤ production)
- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (—É–±–µ–¥–∏–≤—à–∏—Å—å, —á—Ç–æ env.txt –Ω–µ –≤–∫–ª—é—á–µ–Ω)

---

**–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é!** üéâ
