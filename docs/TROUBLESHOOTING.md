# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

## –ü—Ä–æ–±–ª–µ–º–∞: 409 Conflict - Bot cannot start

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Failed to start bot: 409: Conflict: terminated by other getUpdates request
Bot will not be available, but server continues running
```

**–ü—Ä–∏—á–∏–Ω–∞:** –î—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ —É–∂–µ –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ `getUpdates`. Telegram –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º –æ–¥–Ω–æ–≥–æ –±–æ—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker ps -a

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –ø–æ—Ö–æ–∂–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
docker ps -a | grep -i bot
docker ps -a | grep -i telegram
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Node.js

```bash
# –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã node
ps aux | grep node

# –ü—Ä–æ—Ü–µ—Å—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–æ—Ç–æ–º
ps aux | grep -i bot
ps aux | grep -i telegram
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–µ—Ä—ã/—Ö–æ—Å—Ç—ã

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ –±–æ—Ç –Ω–∞ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–µ—Ä–µ:
- –î—Ä—É–≥–æ–π VPS/—Å–µ—Ä–≤–µ—Ä
- –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –î—Ä—É–≥–æ–π Docker host

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook

–í–æ–∑–º–æ–∂–Ω–æ, –¥–ª—è –±–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω webhook (–≤–º–µ—Å—Ç–æ polling):

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook —á–µ—Ä–µ–∑ Telegram API
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_BOT_TOKEN –Ω–∞ —Ç–æ–∫–µ–Ω –∏–∑ env.txt
curl "https://api.telegram.org/botYOUR_BOT_TOKEN/getWebhookInfo"
```

–ï—Å–ª–∏ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ:
```bash
curl -X POST "https://api.telegram.org/botYOUR_BOT_TOKEN/deleteWebhook?drop_pending_updates=true"
```

### 5. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –≤–º–µ—Å—Ç–æ polling

–ï—Å–ª–∏ –¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ webhook:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π HTTPS URL –¥–ª—è webhook
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook —á–µ—Ä–µ–∑ Telegram API:
```bash
curl -X POST "https://api.telegram.org/botYOUR_BOT_TOKEN/setWebhook?url=https://your-domain.com/api/telegram/webhook"
```

3. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –±–æ—Ç–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è webhook –≤–º–µ—Å—Ç–æ polling (—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ)

### 6. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä

–ù–∞–π–¥–∏—Ç–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker stop <container_name>`
- –£–±–µ–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã: `pkill -f "node.*bot"`
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

### 7. –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥—Ä—É–≥–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞—à –±–æ—Ç
docker compose restart backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs backend | grep -i "bot started"
```

## –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –ù–µ—Ç –ª–æ–≥–æ–≤ –æ callback –∑–∞–ø—Ä–æ—Å–∞—Ö

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
docker compose logs backend | grep -i "Bot started"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ callback –∑–∞–ø—Ä–æ—Å—ã
docker compose logs -f backend | grep -i "üîî\|CALLBACK\|callback"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ callback handler –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
docker compose logs backend | grep -i "Handlers registered"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω** (–æ—à–∏–±–∫–∞ 409 –∏–ª–∏ –¥—Ä—É–≥–∞—è)
   - –†–µ—à–µ–Ω–∏–µ: –°–º. —Ä–∞–∑–¥–µ–ª "–ü—Ä–æ–±–ª–µ–º–∞: 409 Conflict"

2. **Callback –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ –±–æ—Ç–∞**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–µ

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MANAGER_GROUP_CHAT_ID**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `env.txt`: `MANAGER_GROUP_CHAT_ID` –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å ID –≥—Ä—É–ø–ø—ã
   - ID –≥—Ä—É–ø–ø—ã - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-5219963496`)

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω:
```bash
docker compose logs backend | grep "üöÄ Telegram Bot started"
```

2. –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω, —Ä–µ—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É 409 (—Å–º. –≤—ã—à–µ)

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã:
```bash
docker compose exec backend env | grep MANAGER_GROUP_CHAT_ID
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
```bash
docker compose restart backend
```

## –ü—Ä–æ–±–ª–µ–º–∞: database "chvetyk" does not exist

**–†–µ—à–µ–Ω–∏–µ:** –°–º. [docs/LOGS.md](LOGS.md#–ø—Ä–æ–±–ª–µ–º–∞-database-chvetyk-does-not-exist)
